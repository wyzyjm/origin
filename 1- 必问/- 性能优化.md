# 性能优化

-   优化原因

-   具体方案

    -   `传统网站`:

        -   CSS: 放在页面上面, 因为 css 解析不会阻塞 DOM 解析, 但会阻塞页面渲染.
            -   合理使用 CSS 选择器, 最好不要嵌套超过三层, 使用 id 选择器就没必要再进行嵌套.
            -   css 文件中避免使用 @import, 因为@import 会影响浏览器并行下载, 需要先下载解析 css 文件,然后再去下载 @import 的 css 文件.
        -   JS 脚本放在最底部.添加 asyc 属性. 因为 js 解析会阻塞 DOM 解析.
        -   复杂的图标使用精灵图,使用 background-position 的方式来呈现图标
        -   将小的 icon 图片转成 base64 编码.
        -   `静态资源本地化`:
            -   `协商缓存`:服务端在返回资源的时候,设置响应头 Etag 和 last-modified, 如果命中协商缓存(max-age,cache-cotrol), 就不会发送请求,如果没有命中,则发送请求,如果文件没有被修改,则返回 304, 如果修改了,则返回最新的.
            -   `强缓存` :cache-control

    -   `SPA 应用主要是首屏加载的优化`,

        -   `让用户尽早的看到网站内容`: 使用 loading 动画, 或者 骨架屏.
        -   减少入口文件体积:

            -   常用的手段就是路由懒加载, 把不同路由对应的组件分割成不同的代码块. 待路由被请求时会单独打包路由.
            -   Vue: 箭头函数的形式 import 组件, React 可以使用 lazy 方法来引用组件.

        -   UI 框架:按需加载
        -   `React`
            -   类组件:
                -   大部分情况下创建组件时可以 继承 `PureComponent`, `它实现了shouldComponentUpdate`的浅层比较.
                -   在 `shouldConentUpdate` 里面判断 当前 state 与接下来的 props,state 是否相同,来避免不必要的渲染.
            -   函数式组件: 通过 `Memo` 包裹组件 来实现组件的缓存.
            -   组件编写的时候,属性值尽量抽取成一个变量.
            -   然后就是 `useMemo` 和 `useCallback` 的使用.
        -   `webpack`
            -   缩小构建目标, 在使用 loader 的时候, `exclude:/node_modules/`将 node_modules 排除
