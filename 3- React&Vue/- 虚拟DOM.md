# 虚拟 DOM

-   本质就是: React.createElement 创建的一个 js 对象来模拟 真实的 dom 节点, 包含 元素的标签,key, props 属性,children 等必要属性.
-   做了什么:

    -   首次加载将真实 dom 转化为虚拟 dom,
    -   更新的时候: 生成一个新的虚拟 dom, 利用 diff 算法去做对比.实际比较两个 js 对象, 然后找出差异点,局部更新视图,对比 直接操作 dom 浏览器性能, 这充其量是 js 执行效率的问题.

-   优势:

    -   减少 DOM 操作: 通过 diff 算法来实现差异化更新,来提高浏览器渲染性能.
    -   对内容进行了处理,对<>等进行了转义,防范 xss 攻击.
    -   可跨平台使用
        -   pc 网站: react + react-dom
        -   mo 网站: react + react-native

-   缺点:
    -   虚拟 dom 会消耗额外的内存.
    -   初次渲染的时候不一定会更快, 只是在更新的时候,可以实现精准的定向更新.

## diff 算法

-   实际上 React 维护了两个虚拟 dom, 一个是真实 dom 的副本,一个是具有更新状态的虚拟 DOM. 如何生成 dom 树更新补丁的方式.
-   `更新时机`: setState,以及 hook 调用之后
-   `优化策略`:
    -   树:忽略节点跨层级操作场景, 只对比同一层节点比较 ,如果该节点发生变化,则更新该节点及其子节点.
    -   组件:只要 class 相同,就认为是同一组件, 否则就放到 patch 中.
    -   元素: 插入.移动.删除等操作, 通过标记 key 的方式, react 可以直接移动 dom 节点.

## key 的作用

-   用来判断元素是新创建得还是被移动的元素, 从而减少不必要的渲染.
-   比如一个列表, 当在后面追加一个的时候, 这个列表的更新只有追加的那一个, 当在前面插入的时候, 如果没有 key, 从插入的节点开始,之后的都会重新渲染,
-   而当有 key 的时候, 就只有插入的那段 dom 更新. 删除某一个, 列表不会重新渲染.
-   没有 key 就会使用索引来比较,
-   因此 key 值必须是唯一的值, 不能是随机字符串和 index 索引, 常用数据的 id 来当做 key 值.
